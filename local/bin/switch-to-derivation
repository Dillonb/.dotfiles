#!/usr/bin/env bash
derivation=$1
profile=/nix/var/nix/profiles/system

echo "Switch $(hostname) to $derivation"
echo ""
read -r -p "Are you sure? [y/N] " response
case "$response" in
    [yY][eE][sS]|[yY])
        echo "Realizing derivation"
        nix-store --realise "$derivation"
        echo "Updating $profile"
        echo "Adding $derivation"

        sudo nix-env -p $profile --set "$derivation"
        echo "Added to system profile. Switching to it:"
        sudo "$derivation"/bin/switch-to-configuration switch
        ;;
    *)
        echo "Exiting."
        ;;
esac
